pipeline {
    agent any
   // environment {
   //     REPO_URL = 'https://DittoJenkins@bitbucket.org/empiricom/your-repo-name.git'
  //  }
    stages {
        // choice(QA, DEV)
        stage('Build') {
            steps {
                echo 'Pull code and build'
              //  git credentialsId: 'bitbucket', url: "${REPO_URL}"
                sh 'npm install'
                sh 'npm run build'
            }
        }
 
        stage('Test') {
            steps {
                echo 'Run tests and publish results'
                bat 'npm run test'
            }
        }
        
        stage('Deploy to DEV') {
            when {
                expression { 
                   return params.ENVIRONMENT == 'DEV'
                }
            }
            steps {
                    sh """
                    echo "deploy to production"
                    """
                }
            }
   }

        stage('Deploy to Development') {
            environment {
                VERSION = bat(returnStdout: true, script: '@npm run get-version --silent').trim()
            }
            steps {
                echo 'Deploy package to Dev'
                sh "serverless deploy --alias DEV --region ${env.DEPLOY_REGION} --version ${VERSION}"
            }
        }
       
    }
