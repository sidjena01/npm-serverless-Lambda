pipeline {
    agent any
   // environment {
   //     REPO_URL = 'https://DittoJenkins@bitbucket.org/empiricom/your-repo-name.git'
  //  }
    stages {
        choice(QA, DEV)
        stage('Build') {
            steps {
                echo 'Pull code and build'
              //  git credentialsId: 'bitbucket', url: "${REPO_URL}"
                sh 'npm install'
                sh 'npm run build'
            }
        }
 
        stage('Test') {
            steps {
                echo 'Run tests and publish results'
                bat 'npm run test'
            }
        }

        stage('Deploy to Development') {
            environment {
                VERSION = bat(returnStdout: true, script: '@npm run get-version --silent').trim()
            }
            steps {
                echo 'Deploy package to Dev'
                bat "serverless deploy --alias DEV --region ${env.DEPLOY_REGION} --version ${VERSION}"
            }
        }
        stage('Deploy to QA') {
            environment {
                VERSION = bat(returnStdout: true, script: '@npm run get-version --silent').trim()
            }
            input {
                message "Promote package to QA?"
                ok "Promote"
                submitter "${env.QA_DEPLOY_SUBMITTERS}"
            }
            steps {
                echo 'Modify vars and promote package to QA'
                bat "serverless deploy --alias QA --region ${env.DEPLOY_REGION} --version ${VERSION}"
            }
        }
    }
